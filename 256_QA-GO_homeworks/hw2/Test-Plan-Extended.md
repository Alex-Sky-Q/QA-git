# Расширенный тест-план - gRPC

Предварительные условия:

- Система запущена, проходит Readiness probe

## 1. ActDeviceApiService

### Тест 1.1. Создание устройства - неверные значения полей

| Шаг | Действие                                                                                                                                                                 | Ожидаемый результат                                                                                                                                                                                                                                                                             |
|-----|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1   | Отправить запрос `CreateDeviceV1` со след. параметрами:<br />`userId: uId, platform: pl`, где <br />`uId` принимает значения: `"", 0`<br />`pl` принимает значения: `""` | - Пришел ответ `googlerpcStatus` с описанием ошибки<br />- В БД в табл. `devices` не появилось новых записей и не были изменены существующие<br />- В БД в табл. `devices_events` не появилось новых записей и не были изменены существующие <br />- Никакие события не были отправлены в Kafka |

### Тест 1.2. Просмотр несуществующего устройства

| Шаг | Действие                                                                                                                                                                    | Ожидаемый результат                               |
|-----|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|
| 1   | Отправить запрос `DescribeDeviceV1` с параметрами:<br />`deviceId: deviceNoId`, где `deviceNoId` - id несуществующего устройства<br />(которого нет в БД в табл. `devices`) | Пришел ответ `googlerpcStatus` с описанием ошибки |

### Тест 1.3. Просмотр устройства - неверные значения полей

| Шаг | Действие                                                               | Ожидаемый результат                               |
|-----|------------------------------------------------------------------------|---------------------------------------------------|
| 1   | Отправить запрос `DescribeDeviceV1` с параметрами:<br />`deviceId: ""` | Пришел ответ `googlerpcStatus` с описанием ошибки |

### Тест 1.4. Редактирование несуществующего/удаленного устройства

| Шаг | Действие                                                                                                                                                                                            | Ожидаемый результат                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-----|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1   | Отправить запрос `CreateDeviceV1` со след. параметрами:<br />`userId: 1, platform: 'ios'`                                                                                                           | - Пришел ответ `CreateDeviceV1Response` с `deviceId > 0 (deviceId_1)`<br />- В БД в табл. `devices` появилась запись: `id=deviceId_1, platform='ios', user_id=1, entered_at >= {Текущее время} (time_dev_1), removed=false, created_at >= entered_at, updated_at >= created_at`<br />- В БД в табл. `devices_events` появилась запись: `id={int} (event_ID_1), device_id=deviceId_1, type=1, status=1, payload={JSON}, created_at >= {Текущее время} (time_dev_1), updated_at >= created_at`<br />- После отправки события в Kafka в табл. `devices_events` запись `id=event_ID_1` обновляется на `status=2` |
| 2   | Отправить запрос `RemoveDeviceV1` с параметрами:<br />`deviceId: deviceId_1`                                                                                                                        | Пришел ответ `RemoveDeviceV1Response`: `found: True`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 3   | Отправить запрос `UpdateDeviceV1` с параметрами:<br />`id: deviceId_1, platform: 'android', userId: 2`                                                                                              | - Пришел ответ `UpdateDeviceV1Response`: `success: False`<br />- В БД в табл. `devices` не появилось новых записей, поля записи с `id=deviceId_1` не были изменены<br />- В БД в табл. `devices_events` не появилось новых записей и не были изменены существующие<br />- Никакие события не были отправлены в Kafka                                                                                                                                                                                                                                                                                         |
| 4   | Отправить запрос `UpdateDeviceV1` с параметрами:<br />`id: deviceNoId, platform: 'android', userId: 2`, где `deviceNoId` - id несуществующего устройства<br />(которого нет в БД в табл. `devices`) | - Пришел ответ `UpdateDeviceV1Response`: `success: False`<br />- В БД в табл. `devices` не появилось новых записей<br />- В БД в табл. `devices_events` не появилось новых записей и не были изменены существующие<br />- Никакие события не были отправлены в Kafka                                                                                                                                                                                                                                                                                                                                         |

### Тест 1.5. Редактирование устройства - неверные значения полей

| Шаг | Действие                                                                                                                                                                                                                                                        | Ожидаемый результат                                                                                                                                                                                                                                                                            |
|-----|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1   | Отправить запрос `UpdateDeviceV1` с параметрами:<br />`deviceId: devId, platform: pl, userId: uId`, где<br />`devId` принимает значения: `"", 0`<br />`pl` принимает значения: `"", "33symbolsInThisStrNameForPlatform"`<br />`uId` принимает значения: `"", 0` | - Пришел ответ `googlerpcStatus` с описанием ошибки<br />- В БД в табл. `devices` не появилось новых записей и не были изменены существующие<br />- В БД в табл. `devices_events` не появилось новых записей и не были изменены существующие<br />- Никакие события не были отправлены в Kafka |

### Тест 1.6. Редактирование устройства без изменения полей

| Шаг | Действие                                                                                             | Ожидаемый результат                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-----|------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1   | Отправить запрос `CreateDeviceV1` со след. параметрами:<br />`userId: 1, platform: 'ios'`            | - Пришел ответ `CreateDeviceV1Response` с `deviceId > 0 (deviceId_1)`<br />- В БД в табл. `devices` появилась запись: `id=deviceId_1, platform='ios', user_id=1, entered_at >= {Текущее время} (time_dev_1), removed=false, created_at >= entered_at, updated_at >= created_at`<br />- В БД в табл. `devices_events` появилась запись: `id={int} (event_ID_1), device_id=deviceId_1, type=1, status=1, payload={JSON}, created_at >= {Текущее время} (time_dev_1), updated_at >= created_at`<br />- После отправки события в Kafka в табл. `devices_events` запись `id=event_ID_1` обновляется на `status=2` |
| 2   | Отправить запрос `UpdateDeviceV1` с параметрами:<br />`id: deviceId_1, platform: "ios", userId: "1"` | NB! В ТЗ эта ситуация не описана. Должно ли происходить обновление, если значения полей не были изменены?<br />- Какой ответ в `UpdateDeviceV1Response` - `success: False` или `True`?<br />- Должно ли обновляться поле `updated_at` в БД?                                                                                                                                                                                                                                                                                                                                                                  |

### Тест 1.7. Удаление несуществующего/удаленного устройства

| Шаг | Действие                                                                                  | Ожидаемый результат                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-----|-------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1   | Отправить запрос `CreateDeviceV1` со след. параметрами:<br />`userId: 1, platform: 'ios'` | - Пришел ответ `CreateDeviceV1Response` с `deviceId > 0 (deviceId_1)`<br />- В БД в табл. `devices` появилась запись: `id=deviceId_1, platform='ios', user_id=1, entered_at >= {Текущее время} (time_dev_1), removed=false, created_at >= entered_at, updated_at >= created_at`<br />- В БД в табл. `devices_events` появилась запись: `id={int} (event_ID_1), device_id=deviceId_1, type=1, status=1, payload={JSON}, created_at >= {Текущее время} (time_dev_1), updated_at >= created_at`<br />- После отправки события в Kafka в табл. `devices_events` запись `id=event_ID_1` обновляется на `status=2` |
| 2   | Отправить запрос `RemoveDeviceV1` с параметрами:<br />`deviceId: deviceId_1`              | Пришел ответ `RemoveDeviceV1Response`: `found: True`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 3   | Отправить запрос `RemoveDeviceV1` с параметрами:<br />`deviceId: deviceId_1`              | - Пришел ответ `RemoveDeviceV1Response`: `found: False`<br />- В БД в табл. `devices` поля записи с `id=deviceId_1` не были изменены<br />- В БД в табл. `devices_events` не появилось новых записей и не были изменены существующие<br />- Никакие события не были отправлены в Kafka                                                                                                                                                                                                                                                                                                                       |

### Тест 1.8. Удаление устройства - неверные значения полей

| Шаг | Действие                                                                                                              | Ожидаемый результат                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-----|-----------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1   | Отправить запрос `CreateDeviceV1` со след. параметрами:<br />`userId: 1, platform: 'ios'`                             | - Пришел ответ `CreateDeviceV1Response` с `deviceId > 0 (deviceId_1)`<br />- В БД в табл. `devices` появилась запись: `id=deviceId_1, platform='ios', user_id=1, entered_at >= {Текущее время} (time_dev_1), removed=false, created_at >= entered_at, updated_at >= created_at`<br />- В БД в табл. `devices_events` появилась запись: `id={int} (event_ID_1), device_id=deviceId_1, type=1, status=1, payload={JSON}, created_at >= {Текущее время} (time_dev_1), updated_at >= created_at`<br />- После отправки события в Kafka в табл. `devices_events` запись `id=event_ID_1` обновляется на `status=2` |
| 2   | Отправить запрос `RemoveDeviceV1` с параметрами:<br />`deviceId: devId`, где<br />`devId` принимает значения: `"", 0` | - Пришел ответ `googlerpcStatus` с описанием ошибки<br />- В БД в табл. `devices` никакие записи не были изменены<br />- В БД в табл. `devices_events` не появилось новых записей и не были изменены существующие<br />- Никакие события не были отправлены в Kafka                                                                                                                                                                                                                                                                                                                                          |

### Тест 1.9. Список устройств - неверные значения полей

| Шаг | Действие                                                                                                                              | Ожидаемый результат                               |
|-----|---------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|
| 1   | Отправить запросы `ListDevicesV1` со след. параметрами:<br />`page: "", perPage: pPage`, где<br />`pPage` принимает значения: `"", 0` | Пришел ответ `googlerpcStatus` с описанием ошибки |

## 2. ActNotificationApiService

### Тест 2.1. Отправка уведомления на несуществующее/удаленное устройство

| Шаг | Действие                                                                                                                                                                                                                                                               | Ожидаемый результат                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-----|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1   | Отправить запрос `CreateDeviceV1` со след. параметрами:<br />`userId: 1, platform: 'ios'`                                                                                                                                                                              | - Пришел ответ `CreateDeviceV1Response` с `deviceId > 0 (deviceId_1)`<br />- В БД в табл. `devices` появилась запись: `id=deviceId_1, platform='ios', user_id=1, entered_at >= {Текущее время} (time_dev_1), removed=false, created_at >= entered_at, updated_at >= created_at`<br />- В БД в табл. `devices_events` появилась запись: `id={int} (event_ID_1), device_id=deviceId_1, type=1, status=1, payload={JSON}, created_at >= {Текущее время} (time_dev_1), updated_at >= created_at`<br />- После отправки события в Kafka в табл. `devices_events` запись `id=event_ID_1` обновляется на `status=2` |
| 2   | Отправить запрос `RemoveDeviceV1` с параметрами:<br />`deviceId: deviceId_1`                                                                                                                                                                                           | Пришел ответ `RemoveDeviceV1Response`: `found: True`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 3   | Отправить запрос `SendNotificationV1`:<br />`notification: {deviceId: deviceId_1, message: 'Order is ready', lang: 'LANG_RUSSIAN', notificationStatus: 'STATUS_CREATED'}`                                                                                              | - Пришел ответ `googlerpcStatus` с описанием ошибки<br />- В БД в табл. `notification_events` не появилось новых записей и не были изменены существующие                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 4   | Отправить запрос `SendNotificationV1`:<br />`notification: {deviceId: deviceNoId, message: 'Order is ready', lang: 'LANG_RUSSIAN', notificationStatus: 'STATUS_CREATED'}`, где `deviceNoId` - id несуществующего устройства<br />(которого нет в БД в табл. `devices`) | - Пришел ответ `googlerpcStatus` с описанием ошибки<br />- В БД в табл. `notification_events` не появилось новых записей и не были изменены существующие                                                                                                                                                                                                                                                                                                                                                                                                                                                     |

### Тест 2.2. Отправка уведомлений по граничным значениям времени приветствия

| Шаг | Действие                                                                                                                                                            | Ожидаемый результат                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-----|---------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1   | Отправить запрос `CreateDeviceV1` со след. параметрами:<br />`userId: 1, platform: 'ios'`                                                                           | - Пришел ответ `CreateDeviceV1Response` с `deviceId > 0 (deviceId_1)`<br />- В БД в табл. `devices` появилась запись: `id=deviceId_1, platform='ios', user_id=1, entered_at >= {Текущее время} (time_dev_1), removed=false, created_at >= entered_at, updated_at >= created_at`<br />- В БД в табл. `devices_events` появилась запись: `id={int} (event_ID_1), device_id=deviceId_1, type=1, status=1, payload={JSON}, created_at >= {Текущее время} (time_dev_1), updated_at >= created_at`<br />- После отправки события в Kafka в табл. `devices_events` запись `id=event_ID_1` обновляется на `status=2` |
| 2   | Отправить запрос `SendNotificationV1`:<br />`notification: {deviceId: deviceId_1, message: 'Order is ready', lang: '{LANG}', notificationStatus: 'STATUS_CREATED'}` | - Пришел ответ `SendNotificationV1Response`: `notificationId: {int} (notif_ID_1)`<br />- В БД в табл. `notification_events` создана запись:<br />`id={int} (notif_event_ID_1), device_id=deviceId_5, message='{Greetings}, Order is ready',` <br />`lang={LANG_ID}, status=1, payload={JSON}, created_at >= {Текущее время}, updated_at >= created_at`<br />!{Greetings} принимает значения в зависимости от языка и времени отправки:<br />Утро (6-11), День (11-15), Вечер (15-21), Ночь 1 и 2 (21-24, 0-6). См. в базовом тест-плане                                                                      |

**Список комбинаций для тестирования {Greetings} по граничным значениям** * 

| LANG         | Время отправки, UTC+3 | Ожидаемое значение {Greetings} |
|--------------|-----------------------|--------------------------------|
| LANG_ITALIAN | 6                     | Buon giorno                    |
| LANG_RUSSIAN | 7                     | Доброе утро                    |
| LANG_ESPANOL | 10                    | Buenos dias                    |
| LANG_ESPANOL | 11                    | Buenas tardes                  |
| LANG_RUSSIAN | 12                    | Добрый день                    |
| LANG_ENGLISH | 14                    | Good afternoon                 |
| LANG_ESPANOL | 15                    | Buenas noches                  |
| LANG_RUSSIAN | 16                    | Добрый вечер                   |
| LANG_ITALIAN | 20                    | Buona serata                   |
| LANG_RUSSIAN | 21                    | Доброй ночи                    |
| LANG_ITALIAN | 22                    | Buona notte                    |
| LANG_ESPANOL | 23                    | Buenas noches                  |
| LANG_ITALIAN | 0                     | Buona notte                    |
| LANG_ENGLISH | 1                     | Good night                     |
| LANG_RUSSIAN | 5                     | Доброй ночи                    |

* Список комбинаций по классам эквивалентности см. в Базовом тест-плане

### Тест 2.3. Отправка уведомления с NotificationId

| Шаг | Действие                                                                                                                                                                                                                                                                                                    | Ожидаемый результат                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-----|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1   | Отправить запрос `CreateDeviceV1` со след. параметрами:<br />`userId: 1, platform: 'ios'`                                                                                                                                                                                                                   | - Пришел ответ `CreateDeviceV1Response` с `deviceId > 0 (deviceId_1)`<br />- В БД в табл. `devices` появилась запись: `id=deviceId_1, platform='ios', user_id=1, entered_at >= {Текущее время} (time_dev_1), removed=false, created_at >= entered_at, updated_at >= created_at`<br />- В БД в табл. `devices_events` появилась запись: `id={int} (event_ID_1), device_id=deviceId_1, type=1, status=1, payload={JSON}, created_at >= {Текущее время} (time_dev_1), updated_at >= created_at`<br />- После отправки события в Kafka в табл. `devices_events` запись `id=event_ID_1` обновляется на `status=2` |
| 2   | Отправить запрос `SendNotificationV1` с параметрами:<br />`notification: {notificationId: notifId_1, deviceId: deviceId_1, message: 'Order is ready', lang: 'LANG_RUSSIAN', notificationStatus: 'STATUS_CREATED'}`, <br />где `notifId_1` - id уведомления, которого нет в БД в табл. `notification_events` | - Пришел ответ `SendNotificationV1Response`:<br />`notificationId: notifId_1`<br />- В БД в табл. `notification_events` создана запись:<br />`id=notifId_1, device_id=deviceId_1`                                                                                                                                                                                                                                                                                                                                                                                                                            |
| 3   | Отправить запрос `SendNotificationV1` с параметрами:<br />`notification: {notificationId: notifId_1, deviceId: deviceId_1, message: 'Order is ready', lang: 'LANG_RUSSIAN', notificationStatus: 'STATUS_CREATED'}`                                                                                          | NB! В ТЗ ситуация повторной отправки уведомления с тем же ID не описана.<br />- Должна ли возвращаться ошибка, если значения полей не были изменены?<br />- Должно ли происходить обновление полей, если их значение было изменено?                                                                                                                                                                                                                                                                                                                                                                          |

### Тест 2.4. Отправка уведомления - неверные значения полей

| Шаг | Действие                                                                                                                                                                      | Ожидаемый результат                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-----|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1   | Отправить запрос `CreateDeviceV1` со след. параметрами:<br />`userId: 1, platform: 'ios'`                                                                                     | - Пришел ответ `CreateDeviceV1Response` с `deviceId > 0 (deviceId_1)`<br />- В БД в табл. `devices` появилась запись: `id=deviceId_1, platform='ios', user_id=1, entered_at >= {Текущее время} (time_dev_1), removed=false, created_at >= entered_at, updated_at >= created_at`<br />- В БД в табл. `devices_events` появилась запись: `id={int} (event_ID_1), device_id=deviceId_1, type=1, status=1, payload={JSON}, created_at >= {Текущее время} (time_dev_1), updated_at >= created_at`<br />- После отправки события в Kafka в табл. `devices_events` запись `id=event_ID_1` обновляется на `status=2` |
| 2   | Отправить запрос `SendNotificationV1` с параметрами:<br />`notification: {deviceId: "",`<br />`message: '', lang: '', notificationStatus: ''}`                                | - Пришел ответ `googlerpcStatus` с описанием ошибки<br />- В БД в табл. `notification_events` не появилось новых записей и не были изменены существующие                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 3   | Отправить запрос `SendNotificationV1` с параметрами:<br />`notification: {deviceId: deviceId_1,`<br />`message: 'Order is ready', lang: 'RUS', notificationStatus: 'CREATE'}` | NB! В ТЗ ситуация отправки уведомления с неверными<br />значениями для полей `lang` и `notificationStatus` не описана.<br />- По идее, должен возвращаться ответ `googlerpcStatus` с описанием ошибки                                                                                                                                                                                                                                                                                                                                                                                                        |

### Тест 2.5. Получение уведомления повторное

| Шаг | Действие                                                                                                                                                                                        | Ожидаемый результат                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-----|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1   | Отправить запрос `CreateDeviceV1` со след. параметрами:<br />`userId: 1, platform: 'ios'`                                                                                                       | - Пришел ответ `CreateDeviceV1Response` с `deviceId > 0 (deviceId_1)`<br />- В БД в табл. `devices` появилась запись: `id=deviceId_1, platform='ios', user_id=1, entered_at >= {Текущее время} (time_dev_1), removed=false, created_at >= entered_at, updated_at >= created_at`<br />- В БД в табл. `devices_events` появилась запись: `id={int} (event_ID_1), device_id=deviceId_1, type=1, status=1, payload={JSON}, created_at >= {Текущее время} (time_dev_1), updated_at >= created_at`<br />- После отправки события в Kafka в табл. `devices_events` запись `id=event_ID_1` обновляется на `status=2` |
| 2   | Отправить запрос `SendNotificationV1` с параметрами:<br />`notification: {deviceId: deviceId_1,` <br />`message: 'Order is ready', lang: 'LANG_RUSSIAN', notificationStatus: 'STATUS_CREATED'}` | Пришел ответ `SendNotificationV1Response`: `notificationId: {int} notif_ID_1`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 3   | Отправить запрос `GetNotification`:<br />`deviceId: deviceId_1`                                                                                                                                 | - Пришел ответ `GetNotificationV1Response`:<br />`notification={[]{notificationId: notif_ID_1, message:{Greetings}, Order is ready}}`<br />- В БД в табл. `notification_events` обновлена запись `id = notif_ID_1`: `status=2`                                                                                                                                                                                                                                                                                                                                                                               |
| 4   | Отправить запрос `GetNotification`:<br />`deviceId: deviceId_1`                                                                                                                                 | - Пришел ответ `GetNotificationV1Response`:<br />`notification={[]{notificationId: notif_ID_1, message:{Greetings}, Order is ready}}`<br />- В БД в табл. `notification_events` запись `id = notif_ID_1` не изменена                                                                                                                                                                                                                                                                                                                                                                                         |

### Тест 2.6. Получение неотправленного уведомления

| Шаг | Действие                                                                                  | Ожидаемый результат                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-----|-------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1   | Отправить запрос `CreateDeviceV1` со след. параметрами:<br />`userId: 1, platform: 'ios'` | - Пришел ответ `CreateDeviceV1Response` с `deviceId > 0 (deviceId_1)`<br />- В БД в табл. `devices` появилась запись: `id=deviceId_1, platform='ios', user_id=1, entered_at >= {Текущее время} (time_dev_1), removed=false, created_at >= entered_at, updated_at >= created_at`<br />- В БД в табл. `devices_events` появилась запись: `id={int} (event_ID_1), device_id=deviceId_1, type=1, status=1, payload={JSON}, created_at >= {Текущее время} (time_dev_1), updated_at >= created_at`<br />- После отправки события в Kafka в табл. `devices_events` запись `id=event_ID_1` обновляется на `status=2` |
| 2   | Отправить запрос `GetNotification` с параметрами:<br />`deviceId: deviceId_1`             | Пришел ответ `GetNotificationV1Response`:<br />`{notification: []}`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

### Тест 2.7. Получение уведомления - неверные значения полей

| Шаг | Действие                                                                                  | Ожидаемый результат                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-----|-------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1   | Отправить запрос `CreateDeviceV1` со след. параметрами:<br />`userId: 1, platform: 'ios'` | - Пришел ответ `CreateDeviceV1Response` с `deviceId > 0 (deviceId_1)`<br />- В БД в табл. `devices` появилась запись: `id=deviceId_1, platform='ios', user_id=1, entered_at >= {Текущее время} (time_dev_1), removed=false, created_at >= entered_at, updated_at >= created_at`<br />- В БД в табл. `devices_events` появилась запись: `id={int} (event_ID_1), device_id=deviceId_1, type=1, status=1, payload={JSON}, created_at >= {Текущее время} (time_dev_1), updated_at >= created_at`<br />- После отправки события в Kafka в табл. `devices_events` запись `id=event_ID_1` обновляется на `status=2` |
| 2   | Отправить запрос `GetNotification` с параметрами:<br />`deviceId: ""`                     | Пришел ответ `GetNotificationV1Response`:<br />`{notification: []}`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

### Тест 2.8. Подтверждение неполученного уведомления

| Шаг | Действие                                                                                                                                                                                        | Ожидаемый результат                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-----|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1   | Отправить запрос `CreateDeviceV1` со след. параметрами:<br />`userId: 1, platform: 'ios'`                                                                                                       | - Пришел ответ `CreateDeviceV1Response` с `deviceId > 0 (deviceId_1)`<br />- В БД в табл. `devices` появилась запись: `id=deviceId_1, platform='ios', user_id=1, entered_at >= {Текущее время} (time_dev_1), removed=false, created_at >= entered_at, updated_at >= created_at`<br />- В БД в табл. `devices_events` появилась запись: `id={int} (event_ID_1), device_id=deviceId_1, type=1, status=1, payload={JSON}, created_at >= {Текущее время} (time_dev_1), updated_at >= created_at`<br />- После отправки события в Kafka в табл. `devices_events` запись `id=event_ID_1` обновляется на `status=2` |
| 2   | Отправить запрос `SendNotificationV1` с параметрами:<br />`notification: {deviceId: deviceId_1,` <br />`message: 'Order is ready', lang: 'LANG_RUSSIAN', notificationStatus: 'STATUS_CREATED'}` | Пришел ответ `SendNotificationV1Response`: `notificationId: {int} notif_ID_1`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 3   | Выполнить запрос `AckNotification`:<br />`notificationId: notif_ID_1`                                                                                                                           | NB! В ТЗ ситуация подтверждения неполученного уведомления не описана                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |

### Тест 2.9. Подтверждение несуществующего уведомления

| Шаг | Действие                                                                                                                                                                            | Ожидаемый результат                                                                                                                                                          |
|-----|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1   | Отправить запрос `AckNotification` со след. параметрами:<br />`notificationId: notifNoID`, где `notifNoId` - id уведомления, <br />которого нет в БД в табл. `notification_events`  | NB! В ТЗ ситуация подтверждения несуществующего уведомления не описана.<br />- Предположительно, должен вернуться ответ `AckNotificationV1Response`:<br />  `success: False` |

### Тест 2.10. Подтверждение подтвержденного уведомления

| Шаг | Действие                                                                                                                                                                                        | Ожидаемый результат                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-----|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1   | Отправить запрос `CreateDeviceV1` со след. параметрами:<br />`userId: 1, platform: 'ios'`                                                                                                       | - Пришел ответ `CreateDeviceV1Response` с `deviceId > 0 (deviceId_1)`<br />- В БД в табл. `devices` появилась запись: `id=deviceId_1, platform='ios', user_id=1, entered_at >= {Текущее время} (time_dev_1), removed=false, created_at >= entered_at, updated_at >= created_at`<br />- В БД в табл. `devices_events` появилась запись: `id={int} (event_ID_1), device_id=deviceId_1, type=1, status=1, payload={JSON}, created_at >= {Текущее время} (time_dev_1), updated_at >= created_at`<br />- После отправки события в Kafka в табл. `devices_events` запись `id=event_ID_1` обновляется на `status=2` |
| 2   | Отправить запрос `SendNotificationV1` с параметрами:<br />`notification: {deviceId: deviceId_1,` <br />`message: 'Order is ready', lang: 'LANG_RUSSIAN', notificationStatus: 'STATUS_CREATED'}` | Пришел ответ `SendNotificationV1Response`: `notificationId: {int} notif_ID_1`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| 3   | Отправить запрос `GetNotification` с параметрами:<br />`deviceId: deviceId_1`                                                                                                                   | - Пришел ответ `GetNotificationV1Response`:<br />`notification={[]{notificationId: {int} notif_ID_1, message:{Greetings}, Order is ready}}`                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 4   | Выполнить запрос `AckNotification`:<br />`notificationId: notif_ID_1`                                                                                                                           | - Получен ответ `AckNotificationV1Response: {success: True}`<br />- В БД в табл. `notification_events` обновлена запись `id = notif_ID_1`: `status=3`                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 5   | Выполнить запрос `AckNotification`:<br />`notificationId: notif_ID_1`                                                                                                                           | NB! В ТЗ ситуация повторного подтверждения уведомления не описана.<br />- Должна ли возвращаться ошибка или `success: False`?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |

### Тест 2.11. Подтверждение уведомления - неверные значения полей

| Шаг | Действие                                                      | Ожидаемый результат                                 |
|-----|---------------------------------------------------------------|-----------------------------------------------------|
| 1   | Выполнить запрос `AckNotification`:<br />`notificationId: ""` | - Пришел ответ `googlerpcStatus` с описанием ошибки |

### Тест 2.12. Подписка одновременно несколькими устройствами

| Шаг | Действие                                                                                                                                                                                                                                                                                                                                                          | Ожидаемый результат                                                                                                                                  |
|-----|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1   | Отправить два раза запрос `CreateDeviceV1` со след. параметрами:<br />`userId: 1, platform: 'ios'`<br />`userId: 2, platform: 'android'`                                                                                                                                                                                                                          | - Пришли ответы `CreateDeviceV1Response` с устройствами:<br />`deviceId: {int} (deviceId_1)`<br />`deviceId: {int} (deviceId_2)`                     |
| 2   | Отправить 2 запроса `SendNotificationV1`:<br />`notification:`<br />`{deviceId: deviceId_1, message: 'Sent before subscription',`<br />`lang: 'LANG_ENGLISH', notificationStatus: 'STATUS_CREATED'}`<br />`notification:` <br />`{deviceId: deviceId_2, message: 'Sent before subscription',` <br />`lang: 'LANG_ENGLISH', notificationStatus: 'STATUS_CREATED'}` | Пришло 2 ответа `SendNotificationV1Response`: <br />`notificationId: {int} notif_ID_1`<br />`notificationId: {int} notif_ID_2`                       |
| 3   | Отправить два запроса `SubscribeNotification`:<br />`deviceId: deviceId_1`<br />`deviceId: deviceId_2`                                                                                                                                                                                                                                                            | Соответствующие уведомления пришли каждому из устройств:<br />`notif_ID_1` для устройства `deviceId_1`<br />`notif_ID_2` для устройства `deviceId_2` |

### Тест 2.13. Подписка для несуществующего/удаленного устройства

| Шаг | Действие                                                                                                                                                   | Ожидаемый результат                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|-----|------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1   | Отправить запрос `CreateDeviceV1` со след. параметрами:<br />`userId: 1, platform: 'ios'`                                                                  | - Пришел ответ `CreateDeviceV1Response` с `deviceId > 0 (deviceId_1)`<br />- В БД в табл. `devices` появилась запись: `id=deviceId_1, platform='ios', user_id=1, entered_at >= {Текущее время} (time_dev_1), removed=false, created_at >= entered_at, updated_at >= created_at`<br />- В БД в табл. `devices_events` появилась запись: `id={int} (event_ID_1), device_id=deviceId_1, type=1, status=1, payload={JSON}, created_at >= {Текущее время} (time_dev_1), updated_at >= created_at`<br />- После отправки события в Kafka в табл. `devices_events` запись `id=event_ID_1` обновляется на `status=2` |
| 2   | Отправить запрос `RemoveDeviceV1` с параметрами:<br />`deviceId: deviceId_1`                                                                               | Пришел ответ `RemoveDeviceV1Response: {found: True}`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 3   | Выполнить запрос `SubscribeNotification` с параметрами:<br />`deviceId: deviceId_1`                                                                        | NB! В ТЗ ситуация подписки для удаленного устройства не описана.<br />- Должна возвращаться ошибка?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 4   | Выполнить запрос `SubscribeNotification` с параметрами:<br />`deviceId: deviceNoId`, где `deviceNoId` - id устройства, которого нет в БД в табл. `devices` | NB! В ТЗ ситуация подписки для несуществующего устройства не описана.<br />- Должна возвращаться ошибка?                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |

### Тест 2.14. Подписка - неверные значения полей

| Шаг | Действие                                                                    | Ожидаемый результат                               |
|-----|-----------------------------------------------------------------------------|---------------------------------------------------|
| 1   | Выполнить запрос `SubscribeNotification` с параметрами:<br />`deviceId: ""` | Пришел ответ `googlerpcStatus` с описанием ошибки |
